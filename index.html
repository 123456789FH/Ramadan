<!doctype html>
<html lang="ar" dir="rtl" class="h-full scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#5a382c" />
  <title>ุฑูุถุงู ุงููุจุงุฑู | ุชุทุจูู ุชูุงุนูู</title>

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            fd: {
              paper:'#fbf7f3', sand:'#e9d9c8', tan:'#d8bea4', clay:'#c19b7d',
              bronze:'#a77a5c', wood:'#8b5c45', bark:'#744a38', ink:'#5a382c', deep:'#3b2a22'
            }
          },
          boxShadow: { soft:'0 18px 45px rgba(2,6,23,.10)', stamp:'0 16px 35px rgba(90,56,44,.18)' }
        }
      }
    }
  </script>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">

  <style>
    *{ font-family:'Tajawal',system-ui,-apple-system,Segoe UI,Arial,sans-serif; }
    *,*::before,*::after{ box-sizing:border-box; }

    .paper-bg{
      background:
        radial-gradient(900px 520px at 15% 10%, rgba(167,122,92,.16), transparent 55%),
        radial-gradient(900px 520px at 85% 15%, rgba(193,155,125,.12), transparent 55%),
        linear-gradient(180deg, #fbf7f3, #f6efe8);
    }
    .pattern-overlay{
      background-image:url("data:image/svg+xml,%3Csvg width='72' height='72' viewBox='0 0 72 72' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none'%3E%3Cpath d='M36 10c8 0 14 6 14 14s-6 14-14 14-14-6-14-14 6-14 14-14Z' stroke='%235a382c' stroke-opacity='0.06' stroke-width='2'/%3E%3Cpath d='M10 58c8 0 14 6 14 14' stroke='%235a382c' stroke-opacity='0.06' stroke-width='2'/%3E%3Cpath d='M62 14c0-8-6-14-14-14' stroke='%235a382c' stroke-opacity='0.06' stroke-width='2'/%3E%3C/g%3E%3C/svg%3E");
    }

    .nav-btn{ transition: all .22s ease; }
    .nav-btn.active{
      background: linear-gradient(135deg, #5a382c, #8b5c45);
      color:#fff !important;
      border-color:transparent !important;
      box-shadow: 0 12px 26px rgba(90,56,44,.22);
      transform: translateY(-1px);
    }


    /* Flip cards (ุงูููู) */
    .flip{ perspective: 1000px; }
    .flip-inner{
      position:relative; width:100%; height:100%;
      transform-style:preserve-3d;
      transition: transform .6s ease;
      border-radius: 22px;
    }
    .flip.flipped .flip-inner{ transform: rotateY(180deg); }
    .flip-face{ position:absolute; inset:0; backface-visibility:hidden; border-radius:22px; }
    .flip-back{ transform: rotateY(180deg); }

    /* Modal */
    .modal-hidden{ display:none; }

    .home-fab{
      position: fixed; left: 16px; bottom: 16px; z-index: 60;
      border-radius: 999px; padding: 12px 14px; font-weight: 900;
      background: linear-gradient(135deg, #5a382c, #8b5c45); color: #fff;
      box-shadow: 0 18px 40px rgba(90,56,44,.28);
      border: 2px solid rgba(255,255,255,.25);
      display:flex; align-items:center; gap:10px;
    }

    .dark .paper-bg{
      background:
        radial-gradient(900px 520px at 15% 10%, rgba(167,122,92,.10), transparent 55%),
        radial-gradient(900px 520px at 85% 15%, rgba(193,155,125,.08), transparent 55%),
        linear-gradient(180deg, #1a1411, #0b0908);
    }
  </style>
</head>

<body class="h-full overflow-auto paper-bg text-fd-deep dark:text-white">
  <button class="home-fab" type="button" onclick="showSection('about')" aria-label="ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ">๐ <span>ุงูุฑุฆูุณูุฉ</span></button>

  <div id="app" class="min-h-full pattern-overlay">

    <!-- Header -->
    <header class="border-b border-black/5 dark:border-white/10">
      <div class="max-w-6xl mx-auto px-4 py-6">
        <div class="grid grid-cols-1 md:grid-cols-3 items-center gap-4">

          <div class="flex items-center gap-3 justify-center md:justify-start order-2 md:order-1">
            <img id="ramadanLogo" alt="ุฑูุถุงู" class="w-14 h-14 object-contain" />
            <div>
              <div class="font-black">ุฑูุถุงู</div>
              <div class="text-sm font-extrabold opacity-80">ุดูุฑ ุงูุทุงุนุฉ ูุงููุฑุขู</div>
            </div>
          </div>

          <div class="text-center order-1 md:order-2">
            <h1 class="text-2xl md:text-4xl font-black leading-tight">ุฑูุถุงู ุงููุจุงุฑู</h1>
            <p class="mt-1 font-extrabold text-fd-ink/80 dark:text-white/80">ุชุทุจูู ุงูุงูุถุจุงุท ูุงูููู ูุฌุฏูู ุงูุฃุนูุงู</p>
            <div class="mt-3 flex flex-wrap gap-2 justify-center">
              <span class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/70 dark:bg-white/10 border border-black/10 dark:border-white/15 font-extrabold">
                ๐ ุงูููู: <span id="todayText">โ</span>
              </span>
              <span class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/70 dark:bg-white/10 border border-black/10 dark:border-white/15 font-extrabold">
                โณ ุงููุชุจูู ุนูู ุฑูุถุงู: <span id="countdownText">โ</span>
              </span>
            </div>
          </div>

          <div class="flex items-center gap-2 justify-center md:justify-end order-3">
<button id="resetBtn" class="px-4 py-2 rounded-full font-extrabold border border-black/10 dark:border-white/15 bg-white/70 dark:bg-white/10 hover:bg-white transition">โป๏ธ ุฅุนุงุฏุฉ ุถุจุท</button>
          </div>
        </div>

        <div class="mt-5 grid grid-cols-2 md:grid-cols-4 gap-3">
          <div class="rounded-3xl bg-white/70 dark:bg-white/10 border border-black/10 dark:border-white/15 p-4 shadow-stamp">
            <div class="text-sm font-extrabold opacity-80">โญ ููุงุทู</div>
            <div id="pointsText" class="text-2xl font-black mt-1">ู</div>
          </div>
          <div class="rounded-3xl bg-white/70 dark:bg-white/10 border border-black/10 dark:border-white/15 p-4 shadow-stamp">
            <div class="text-sm font-extrabold opacity-80">๐ ุดุงุฑุชู</div>
            <div id="badgeText" class="text-lg font-black mt-1">โ</div>
          </div>
          <div class="rounded-3xl bg-white/70 dark:bg-white/10 border border-black/10 dark:border-white/15 p-4 shadow-stamp">
            <div class="text-sm font-extrabold opacity-80">โ ุชูุฏูู ุงูููู</div>
            <div id="todayProgressText" class="text-2xl font-black mt-1">ููช</div>
          </div>
          <div class="rounded-3xl bg-white/70 dark:bg-white/10 border border-black/10 dark:border-white/15 p-4 shadow-stamp">
            <div class="text-sm font-extrabold opacity-80">๐ ุงูุชูุฏู</div>
            <div class="mt-2 h-3 bg-black/5 dark:bg-white/10 rounded-full overflow-hidden border border-black/10 dark:border-white/15">
              <div id="overallBar" class="h-full bg-gradient-to-l from-fd-wood to-fd-sand" style="width:0%"></div>
            </div>
          </div>
        </div>

      </div>
    </header>

    <!-- Navigation -->
    <nav class="sticky top-0 z-50 bg-white/85 dark:bg-black/55 backdrop-blur shadow-xl border-b border-black/5 dark:border-white/10">
      <div class="max-w-6xl mx-auto px-4 py-3">
        <div class="flex justify-center gap-2 flex-wrap">
          <button class="nav-btn active px-5 py-2.5 rounded-full font-extrabold text-sm border-2 border-fd-bark text-fd-ink dark:text-white dark:border-white/20" data-section="about" onclick="showSection('about')">๐ ูุง ูู ุฑูุถุงู</button>
          <button class="nav-btn px-5 py-2.5 rounded-full font-extrabold text-sm border-2 border-fd-bark text-fd-ink dark:text-white dark:border-white/20" data-section="values" onclick="showSection('values')">๐ฟ ุงูููู</button>
          <button class="nav-btn px-5 py-2.5 rounded-full font-extrabold text-sm border-2 border-fd-bark text-fd-ink dark:text-white dark:border-white/20" data-section="schedule" onclick="showSection('schedule')">๐งพ ุงูุฌุฏูู</button>
          <button class="nav-btn px-5 py-2.5 rounded-full font-extrabold text-sm border-2 border-fd-bark text-fd-ink dark:text-white dark:border-white/20" data-section="tracker" onclick="showSection('tracker')">โ ุงููุชุงุจุนุฉ</button>
          <button class="nav-btn px-5 py-2.5 rounded-full font-extrabold text-sm border-2 border-fd-bark text-fd-ink dark:text-white dark:border-white/20" data-section="media" onclick="showSection('media')">๐ป ุงูุฃุฐูุงุฑ ูุงููุฑุขู</button>
          <button class="nav-btn px-5 py-2.5 rounded-full font-extrabold text-sm border-2 border-fd-bark text-fd-ink dark:text-white dark:border-white/20" data-section="students" onclick="showSection('students')">๐ ููุทูุงุจ</button>
        </div>
      </div>
    </nav>

    <main class="max-w-6xl mx-auto px-4 py-8">

      <!-- ABOUT -->
      <section id="about-section" class="section-content">
        <div class="bg-white/85 dark:bg-white/5 rounded-[28px] shadow-soft border border-black/5 dark:border-white/10 p-6 md:p-8">
          <div class="flex items-center gap-3 mb-6">
            <div class="w-12 h-12 rounded-2xl bg-fd-sand/70 dark:bg-white/10 border border-black/5 dark:border-white/10 flex items-center justify-center text-2xl shadow-stamp">๐</div>
            <h2 class="text-2xl md:text-3xl font-black">ูุง ูู ุดูุฑ ุฑูุถุงูุ</h2>
          </div>

          <div class="space-y-4 text-lg leading-relaxed opacity-95">
            <p>
              <b>ุฑูุถุงู</b> ูู ุงูุดูุฑ ุงูุชุงุณุน ูู ุงูุชูููู ุงููุฌุฑูุ ุดูุฑ <b>ุงูุตูุงู</b> ูุงูุนุจุงุฏุฉ ูุงููุฑุขู.
              ูุตูู ูู <b>ุงููุฌุฑ</b> ุฅูู <b>ุงููุบุฑุจ</b>ุ ูููุซุฑ ูู ุงูุตูุงุฉ ูุงูุฐูุฑ ูุงูุตุฏูุฉ ูุงูุฅุญุณุงู.
            </p>

            <div class="rounded-2xl p-5 border-r-4 border-fd-bark bg-gradient-to-l from-fd-sand/70 to-white/70 dark:from-white/10 dark:to-white/5">
              <p class="font-black mb-2">๐ฏ ุฃูุฏุงู ุนูููุฉ ูุฑูุถุงู</p>
              <ul class="mt-1 space-y-2 font-semibold">
                <li>โข ูุฑุฏ ูููู ูู ุงููุฑุขู (ุตูุญุงุช ุจุณูุทุฉ).</li>
                <li>โข ุงูุตูุงุฉ ูู ููุชูุง + ุฃุฐูุงุฑ ุงูุตุจุงุญ ูุงููุณุงุก.</li>
                <li>โข ุจุฑู ุงููุงูุฏูู + ุงูุฅูุซุงุฑ ูู ุงูุงุณุชุบูุงุฑ.</li>
                <li>โข ููุทูุงุจ: ูุฐุงูุฑุฉ ูุงุฌุชูุงุฏ + ุญู ุงููุงุฌุจุงุช ุจุฏูู ุฅููุงู.</li>
              </ul>
            </div>

            <div class="rounded-2xl p-5 border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/5">
              <div class="flex items-center justify-between gap-3 flex-wrap">
                <div class="flex items-center gap-2">
                  <span class="text-2xl">โณ</span>
                  <p class="font-black text-lg">ูุคูุช ุฑูุถุงู</p>
                </div>
                <p class="text-sm font-extrabold opacity-80">ูุชุญุฏูุซ ุชููุงุฆูุงู ูู ุซุงููุฉ</p>
              </div>

              <div class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-3">
                <div class="rounded-2xl p-4 border border-black/5 dark:border-white/10 bg-gradient-to-br from-fd-sand/70 to-white/70 dark:from-white/10 dark:to-white/5 text-center">
                  <div class="text-sm font-extrabold opacity-80">ุฃูุงู</div>
                  <div id="cdDays" class="text-3xl font-black mt-1">โ</div>
                </div>
                <div class="rounded-2xl p-4 border border-black/5 dark:border-white/10 bg-gradient-to-br from-fd-sand/70 to-white/70 dark:from-white/10 dark:to-white/5 text-center">
                  <div class="text-sm font-extrabold opacity-80">ุณุงุนุงุช</div>
                  <div id="cdHours" class="text-3xl font-black mt-1">โ</div>
                </div>
                <div class="rounded-2xl p-4 border border-black/5 dark:border-white/10 bg-gradient-to-br from-fd-sand/70 to-white/70 dark:from-white/10 dark:to-white/5 text-center">
                  <div class="text-sm font-extrabold opacity-80">ุฏูุงุฆู</div>
                  <div id="cdMinutes" class="text-3xl font-black mt-1">โ</div>
                </div>
                <div class="rounded-2xl p-4 border border-black/5 dark:border-white/10 bg-gradient-to-br from-fd-sand/70 to-white/70 dark:from-white/10 dark:to-white/5 text-center">
                  <div class="text-sm font-extrabold opacity-80">ุซูุงูู</div>
                  <div id="cdSeconds" class="text-3xl font-black mt-1">โ</div>
                </div>
              </div>

              <div id="cdNote" class="mt-4 text-center font-extrabold opacity-85"></div>

              <div class="mt-5 rounded-2xl p-4 border border-black/5 dark:border-white/10 bg-gradient-to-l from-fd-tan/40 to-white/70 dark:from-white/10 dark:to-white/5">
                <div class="font-black mb-2">โ๏ธ ุชุนุฏูู ููุนุฏ ุฑูุถุงู (ุงุฎุชูุงุฑู)</div>
                <div class="grid md:grid-cols-3 gap-3 items-end">
                  <div>
                    <label class="block text-sm font-extrabold opacity-80 mb-2">ุงูุชุงุฑูุฎ (ูููุงุฏู)</label>
                    <input id="ramadanDateInput" type="date" class="w-full rounded-2xl px-4 py-3 border border-black/10 dark:border-white/15 bg-white/80 dark:bg-white/10 outline-none" />
                  </div>
                  <div>
                    <label class="block text-sm font-extrabold opacity-80 mb-2">ุงูููุช</label>
                    <input id="ramadanTimeInput" type="time" class="w-full rounded-2xl px-4 py-3 border border-black/10 dark:border-white/15 bg-white/80 dark:bg-white/10 outline-none" />
                  </div>
                  <button id="saveRamadanTargetBtn" class="w-full md:w-auto px-6 py-3 rounded-2xl font-black bg-gradient-to-l from-fd-deep to-fd-ink text-white hover:opacity-95">๐พ ุญูุธ ุงูููุนุฏ</button>
                </div>
                <div class="mt-2 text-sm font-extrabold opacity-75">ูุฏ ูุฎุชูู ุฏุฎูู ุฑูุถุงู ุญุณุจ ุงูุฑุคูุฉ. ููููู ุชุนุฏูู ุงูููุนุฏ ุจุณูููุฉ.</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- VALUES -->
      <section id="values-section" class="section-content hidden">
        <div class="bg-white/85 dark:bg-white/5 rounded-[28px] shadow-soft border border-black/5 dark:border-white/10 p-6 md:p-8">
          <div class="flex items-center gap-3 mb-6">
            <div class="w-12 h-12 rounded-2xl bg-fd-sand/70 dark:bg-white/10 border border-black/5 dark:border-white/10 flex items-center justify-center text-2xl shadow-stamp">๐ฟ</div>
            <h2 class="text-2xl md:text-3xl font-black">ุงูููู ุงูุชู ูุจูููุง ูู ุฑูุถุงู</h2>
          </div>

          <div id="valuesGrid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>

          <div class="mt-6 rounded-2xl p-5 border border-black/5 dark:border-white/10 bg-gradient-to-l from-fd-sand/60 to-white/70 dark:from-white/10 dark:to-white/5">
            <div class="font-black mb-2">๐ฏ ุชุทุจูู ุณุฑูุน</div>
            <div class="font-semibold opacity-85">ุงุฎุชุฑ ูฃ ููู ูุฐุง ุงูุฃุณุจูุน ูุทุจูููุง ููููุงูุ ุซู ุณุฌูู ุชูุฏูู ูู ูุณู ุงููุชุงุจุนุฉ.</div>
          </div>
        </div>
      </section>


      <!-- MEDIA -->
      <section id="media-section" class="section-content hidden">
        <div class="bg-white/85 dark:bg-white/5 rounded-[28px] shadow-soft border border-black/5 dark:border-white/10 p-6 md:p-8">
          <div class="flex items-center gap-3 mb-6">
            <div class="w-12 h-12 rounded-2xl bg-fd-sand/70 dark:bg-white/10 border border-black/5 dark:border-white/10 flex items-center justify-center text-2xl shadow-stamp">๐ป</div>
            <h2 class="text-2xl md:text-3xl font-black">ุงูุฃุฐูุงุฑ ูุงููุฑุขู</h2>
          </div>

          <div class="grid lg:grid-cols-2 gap-4">
            <!-- ุฃุฐูุงุฑ ุงูุตุจุงุญ -->
            <div class="rounded-2xl p-5 border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/5">
              <div class="flex items-center justify-between gap-2 flex-wrap">
                <div class="font-black text-lg">๐ ุฃุฐูุงุฑ ุงูุตุจุงุญ</div>
                <div class="flex gap-2 flex-wrap">
                  <button id="amMarkDoneBtn" class="px-4 py-2 rounded-2xl font-black bg-gradient-to-l from-fd-deep to-fd-ink text-white hover:opacity-95">โ ุชููุช</button>
</div>
              </div>
              <div class="mt-2 text-sm font-extrabold opacity-80">ูุตูุต ูุฎุชุงุฑุฉ โ ููููู ุงูุงูุชูุงุก ุจูุง ุชุญูุธ.</div>
              <div id="adhkarAmList" class="mt-4 space-y-3"></div>
              <div class="mt-3 text-sm font-extrabold opacity-75">๐ ูุฑุฌุน (ุงุฎุชูุงุฑู): <a class="underline" href="https://hisnmuslim.com/" target="_blank" rel="noopener">ุญุตู ุงููุณูู</a></div>
            </div>

            <!-- ุฃุฐูุงุฑ ุงููุณุงุก -->
            <div class="rounded-2xl p-5 border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/5">
              <div class="flex items-center justify-between gap-2 flex-wrap">
                <div class="font-black text-lg">๐ ุฃุฐูุงุฑ ุงููุณุงุก</div>
                <div class="flex gap-2 flex-wrap">
                  <button id="pmMarkDoneBtn" class="px-4 py-2 rounded-2xl font-black bg-gradient-to-l from-fd-deep to-fd-ink text-white hover:opacity-95">โ ุชููุช</button>
</div>
              </div>
              <div class="mt-2 text-sm font-extrabold opacity-80">ูุตูุต ูุฎุชุงุฑุฉ โ ููููู ุงูุงูุชูุงุก ุจูุง ุชุญูุธ.</div>
              <div id="adhkarPmList" class="mt-4 space-y-3"></div>
              <div class="mt-3 text-sm font-extrabold opacity-75">๐ ูุฑุฌุน (ุงุฎุชูุงุฑู): <a class="underline" href="https://hisnmuslim.com/" target="_blank" rel="noopener">ุญุตู ุงููุณูู</a></div>
            </div>
          </div>

          <div class="mt-6 grid lg:grid-cols-2 gap-4">
            <!-- ุฅุฐุงุนุฉ ุงููุฑุขู -->
            <div class="rounded-2xl p-5 border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/5">
              <div class="font-black text-lg">๐ป ุฅุฐุงุนุฉ ุงููุฑุขู (ุงุณุชูุงุน ุฏุงุฎู ุงูุชุทุจูู)</div>
              <div class="mt-2 text-sm font-extrabold opacity-80">ุงุฎุชุฑ ูุญุทุฉ ุฌุงูุฒุฉ ุฃู ุงูุตู ุฑุงุจุท ุจุซ ูุจุงุดุฑุ ุซู ุงุถุบุท ุชุดุบูู.</div>

              <div class="mt-3 grid md:grid-cols-2 gap-2">
                <select id="radioPreset" class="w-full rounded-2xl px-4 py-3 border border-black/10 dark:border-white/15 bg-white/80 dark:bg-white/10 outline-none">
                  <option value="">ุงุฎุชุฑ ูุญุทุฉโฆ</option>
                  <option value="https://qurango.net/radio/tarateel">ุฅุฐุงุนุฉ ุชูุงูุงุช (Qurango)</option>
                  <option value="https://qurango.net/radio/mishary_alafasi">ูุดุงุฑู ุงูุนูุงุณู (Qurango)</option>
                  <option value="https://qurango.net/radio/abdulrahman_alsudaes">ุงูุณุฏูุณ (Qurango)</option>
                </select>
                <input id="radioUrlInput" type="url" class="w-full rounded-2xl px-4 py-3 border border-black/10 dark:border-white/15 bg-white/80 dark:bg-white/10 outline-none" placeholder="ุฃู ุงูุชุจ ุฑุงุจุท ุงูุฅุฐุงุนุฉ ููุง" />
              </div>

              <div class="mt-3 flex gap-2 flex-wrap">
                <button id="radioPlayBtn" class="px-5 py-3 rounded-2xl font-black bg-gradient-to-l from-fd-deep to-fd-ink text-white hover:opacity-95">๐ง ุชุดุบูู</button>
                <button id="radioStopBtn" class="px-5 py-3 rounded-2xl font-black border-2 border-fd-bark hover:bg-fd-sand/50 dark:hover:bg-white/10">โน๏ธ ุฅููุงู</button>
                <button id="radioSaveBtn" class="px-5 py-3 rounded-2xl font-black border-2 border-fd-bark hover:bg-fd-sand/50 dark:hover:bg-white/10">๐พ ุญูุธ</button>
              </div>

              <audio id="radioPlayer" class="w-full mt-4" controls preload="none"></audio>
              <div id="radioHint" class="mt-2 text-sm font-extrabold opacity-80"></div>
            </div>

            <!-- ุงููุตุญู ุงููุฑุชู -->
            <div class="rounded-2xl p-5 border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/5">
              <div class="font-black text-lg">๐ง ุงููุตุญู ุงููุฑุชู (MP3)</div>
              <div class="mt-2 text-sm font-extrabold opacity-80">ุงุฎุชุฑ ุณูุฑุฉ ูุตูุฑุฉ ุฃู ุงูุตู ุฑุงุจุท MP3ุ ุซู ุงุถุบุท ุชุดุบูู.</div>

              <div class="mt-3 grid md:grid-cols-2 gap-2">
                <select id="murattalPreset" class="w-full rounded-2xl px-4 py-3 border border-black/10 dark:border-white/15 bg-white/80 dark:bg-white/10 outline-none">
                  <option value="">ุงุฎุชุฑ ุชูุงูุฉโฆ</option>
                  <option value="https://download.quranicaudio.com/quran/mishaari_raashid_al_3afaasee/001.mp3">ุงููุงุชุญุฉ (ุงูุนูุงุณู)</option>
                  <option value="https://download.quranicaudio.com/quran/mishaari_raashid_al_3afaasee/036.mp3">ูุณ (ุงูุนูุงุณู)</option>
                  <option value="https://download.quranicaudio.com/quran/mishaari_raashid_al_3afaasee/067.mp3">ุงูููู (ุงูุนูุงุณู)</option>
                </select>
                <input id="murattalUrlInput" type="url" class="w-full rounded-2xl px-4 py-3 border border-black/10 dark:border-white/15 bg-white/80 dark:bg-white/10 outline-none" placeholder="ุฃู ุงูุชุจ ุฑุงุจุท MP3 ููุง" />
              </div>

              <div class="mt-3 flex gap-2 flex-wrap">
                <button id="murattalPlayBtn" class="px-5 py-3 rounded-2xl font-black bg-gradient-to-l from-fd-deep to-fd-ink text-white hover:opacity-95">๐ง ุชุดุบูู</button>
                <button id="murattalStopBtn" class="px-5 py-3 rounded-2xl font-black border-2 border-fd-bark hover:bg-fd-sand/50 dark:hover:bg-white/10">โน๏ธ ุฅููุงู</button>
                <button id="murattalSaveBtn" class="px-5 py-3 rounded-2xl font-black border-2 border-fd-bark hover:bg-fd-sand/50 dark:hover:bg-white/10">๐พ ุญูุธ</button>
                <a class="px-5 py-3 rounded-2xl font-black border-2 border-fd-bark hover:bg-fd-sand/50 dark:hover:bg-white/10" href="https://quran.com" target="_blank" rel="noopener">๐ ูุชุญ ุงููุตุญู</a>
              </div>

              <audio id="murattalPlayer" class="w-full mt-4" controls preload="none"></audio>
              <div id="murattalHint" class="mt-2 text-sm font-extrabold opacity-80"></div>
            </div>
          </div>

          <div class="mt-5 rounded-2xl p-4 border border-black/5 dark:border-white/10 bg-gradient-to-l from-fd-sand/50 to-white/70 dark:from-white/10 dark:to-white/5">
            <div class="font-black mb-1">ููุงุญุธุฉ</div>
            <div class="text-sm font-extrabold opacity-80">ูุฏ ูุง ูุนูู ุจุนุถ ุงูุจุซ ุนูู ุจุนุถ ุงูุดุจูุงุช. ุฅู ูู ูุนููุ ุฌุฑูุจ ูุญุทุฉ ุฃุฎุฑู ุฃู ุถุน ุฑุงุจุท ูุฎุชูู.</div>
          </div>
        </div>
      </section>

      <!-- SCHEDULE -->
      <section id="schedule-section" class="section-content hidden">
        <div class="bg-white/85 dark:bg-white/5 rounded-[28px] shadow-soft border border-black/5 dark:border-white/10 p-6 md:p-8">
          <div class="flex items-center gap-3 mb-6">
            <div class="w-12 h-12 rounded-2xl bg-fd-sand/70 dark:bg-white/10 border border-black/5 dark:border-white/10 flex items-center justify-center text-2xl shadow-stamp">๐งพ</div>
            <h2 class="text-2xl md:text-3xl font-black">ุฌุฏูู ุงูุฃุนูุงู ุงููููู</h2>
          </div>

          <div class="rounded-2xl p-4 border border-black/5 dark:border-white/10 bg-gradient-to-l from-fd-sand/50 to-white/70 dark:from-white/10 dark:to-white/5">
            <div class="font-black mb-2">โ ุฌุฏูู ููุชุฑุญ (ููููู ุชุนุฏูู ุงููุญุชูู ูุญูุธู)</div>
            <div class="text-sm font-extrabold opacity-80">ูุชู ุญูุธ ุงูุชุนุฏููุงุช ูุญููุงู ุนูู ุฌูุงุฒู.</div>
          </div>

          <div class="mt-4 overflow-x-auto rounded-2xl border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/5">
            <table class="min-w-[860px] w-full text-right">
              <thead class="bg-black/5 dark:bg-white/10">
                <tr>
                  <th class="p-3 font-black">ุงููุชุฑุฉ</th>
                  <th class="p-3 font-black">ุนุจุงุฏุงุช</th>
                  <th class="p-3 font-black">ููุทูุงุจ</th>
                </tr>
              </thead>
              <tbody id="scheduleBody"></tbody>
            </table>
          </div>

          <div class="mt-4 flex gap-2 flex-wrap">
            <button id="saveScheduleBtn" class="px-6 py-3 rounded-2xl font-black bg-gradient-to-l from-fd-deep to-fd-ink text-white hover:opacity-95">๐พ ุญูุธ ุงูุฌุฏูู</button>
            <button id="resetScheduleBtn" class="px-6 py-3 rounded-2xl font-black border-2 border-fd-bark hover:bg-fd-sand/50 dark:hover:bg-white/10">โป๏ธ ุงุณุชุฑุฌุงุน ุงูุงูุชุฑุงุถู</button>
          </div>

          <div id="scheduleSavedMsg" class="mt-3 text-sm font-extrabold opacity-80"></div>
        </div>
      </section>

      <!-- TRACKER -->
      <section id="tracker-section" class="section-content hidden">
        <div class="bg-white/85 dark:bg-white/5 rounded-[28px] shadow-soft border border-black/5 dark:border-white/10 p-6 md:p-8">
          <div class="flex items-center gap-3 mb-6">
            <div class="w-12 h-12 rounded-2xl bg-fd-sand/70 dark:bg-white/10 border border-black/5 dark:border-white/10 flex items-center justify-center text-2xl shadow-stamp">โ</div>
            <h2 class="text-2xl md:text-3xl font-black">ุงููุชุงุจุนุฉ ุงูููููุฉ</h2>
          </div>

          <div class="grid lg:grid-cols-2 gap-4">
            <div class="rounded-2xl p-5 border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/5">
              <div class="flex items-center justify-between gap-2">
                <div class="font-black text-lg">๐ ุนุจุงุฏุงุช ุงูููู</div>
                <div class="text-sm font-extrabold opacity-80">ุชุงุฑูุฎ: <span id="todayKeyText">โ</span></div>
              </div>

              <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3">
                <label class="flex items-center gap-3 p-3 rounded-2xl border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/10 cursor-pointer"><input type="checkbox" class="w-5 h-5" data-check="fajr" /><span class="font-extrabold">ุงููุฌุฑ ูู ููุชูุง</span></label>
                <label class="flex items-center gap-3 p-3 rounded-2xl border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/10 cursor-pointer"><input type="checkbox" class="w-5 h-5" data-check="dhuhr" /><span class="font-extrabold">ุงูุธูุฑ ูู ููุชูุง</span></label>
                <label class="flex items-center gap-3 p-3 rounded-2xl border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/10 cursor-pointer"><input type="checkbox" class="w-5 h-5" data-check="asr" /><span class="font-extrabold">ุงูุนุตุฑ ูู ููุชูุง</span></label>
                <label class="flex items-center gap-3 p-3 rounded-2xl border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/10 cursor-pointer"><input type="checkbox" class="w-5 h-5" data-check="maghrib" /><span class="font-extrabold">ุงููุบุฑุจ ูู ููุชูุง</span></label>
                <label class="flex items-center gap-3 p-3 rounded-2xl border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/10 cursor-pointer"><input type="checkbox" class="w-5 h-5" data-check="isha" /><span class="font-extrabold">ุงูุนุดุงุก ูู ููุชูุง</span></label>
                <label class="flex items-center gap-3 p-3 rounded-2xl border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/10 cursor-pointer"><input type="checkbox" class="w-5 h-5" data-check="taraweeh" /><span class="font-extrabold">ุงูุชุฑุงููุญ</span></label>

                <label class="flex items-center gap-3 p-3 rounded-2xl border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/10 cursor-pointer"><input type="checkbox" class="w-5 h-5" data-check="adhkarAm" /><span class="font-extrabold">ุฃุฐูุงุฑ ุงูุตุจุงุญ</span></label>
                <label class="flex items-center gap-3 p-3 rounded-2xl border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/10 cursor-pointer"><input type="checkbox" class="w-5 h-5" data-check="adhkarPm" /><span class="font-extrabold">ุฃุฐูุงุฑ ุงููุณุงุก</span></label>

                <label class="flex items-center gap-3 p-3 rounded-2xl border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/10 cursor-pointer"><input type="checkbox" class="w-5 h-5" data-check="parents" /><span class="font-extrabold">ุจุฑู ุงููุงูุฏูู</span></label>
                <label class="flex items-center gap-3 p-3 rounded-2xl border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/10 cursor-pointer"><input type="checkbox" class="w-5 h-5" data-check="charity" /><span class="font-extrabold">ุตุฏูุฉ / ุฅุญุณุงู</span></label>
              </div>

              <div class="mt-5 grid md:grid-cols-2 gap-4">
                <div class="rounded-2xl p-4 border border-black/5 dark:border-white/10 bg-gradient-to-l from-fd-sand/50 to-white/70 dark:from-white/10 dark:to-white/5">
                  <div class="font-black mb-2">๐ ูุฑุฏ ุงููุฑุขู</div>
                  <div class="grid grid-cols-2 gap-2">
                    <div>
                      <label class="block text-sm font-extrabold opacity-80 mb-1">ุตูุญุงุช</label>
                      <input id="quranPages" type="number" min="0" class="w-full rounded-2xl px-3 py-2 border border-black/10 dark:border-white/15 bg-white/80 dark:bg-white/10 outline-none" />
                    </div>
                    <div>
                      <label class="block text-sm font-extrabold opacity-80 mb-1">ุงููุฏู</label>
                      <input id="quranGoal" type="number" min="1" class="w-full rounded-2xl px-3 py-2 border border-black/10 dark:border-white/15 bg-white/80 dark:bg-white/10 outline-none" />
                    </div>
                  </div>
                  <div class="mt-2 text-sm font-extrabold opacity-80">ุงุจุฏุฃ ุจูุฑุฏ ุจุณูุท ุซู ุฒุฏ ุชุฏุฑูุฌูุงู.</div>
                </div>

                <div class="rounded-2xl p-4 border border-black/5 dark:border-white/10 bg-gradient-to-l from-fd-tan/40 to-white/70 dark:from-white/10 dark:to-white/5">
                  <div class="font-black mb-2">๐ธ ุงูุงุณุชุบูุงุฑ</div>
                  <div class="flex items-center justify-between gap-3">
                    <div class="text-4xl font-black" id="istighfarCount">ู</div>
                    <div class="flex gap-2 flex-wrap">
                      <button class="px-4 py-2 rounded-2xl font-black bg-gradient-to-l from-fd-deep to-fd-ink text-white hover:opacity-95" data-ist="1">+ูก</button>
                      <button class="px-4 py-2 rounded-2xl font-black border-2 border-fd-bark hover:bg-fd-sand/50 dark:hover:bg-white/10" data-ist="10">+ูกู</button>
                      <button class="px-4 py-2 rounded-2xl font-black border-2 border-fd-bark hover:bg-fd-sand/50 dark:hover:bg-white/10" id="istReset">ุชุตููุฑ</button>
                    </div>
                  </div>
                  <div class="mt-2 text-sm font-extrabold opacity-80">ูุฏู ููุชุฑุญ: ูกูู ููููุงู.</div>
                </div>
              </div>

              <div class="mt-5 flex gap-2 flex-wrap">
                <button id="resetTodayBtn" class="px-6 py-3 rounded-2xl font-black border-2 border-fd-bark hover:bg-fd-sand/50 dark:hover:bg-white/10">โป๏ธ ุชุตููุฑ ููุงู ุงูููู</button>
              </div>
            </div>

            <div class="rounded-2xl p-5 border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/5">
              <div class="font-black text-lg">๐ ููุทูุงุจ</div>
              <div class="mt-2 text-sm font-extrabold opacity-80">ูุฐุงูุฑุฉ ูุงุฌุชูุงุฏ ูุญู ูุงุฌุจุงุช.</div>

              <div class="mt-4 space-y-3">
                <label class="flex items-center gap-3 p-3 rounded-2xl border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/10 cursor-pointer"><input type="checkbox" class="w-5 h-5" data-check="study" /><span class="font-extrabold">ูุฐุงูุฑุฉ / ูุฑุงุฌุนุฉ</span></label>
                <label class="flex items-center gap-3 p-3 rounded-2xl border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/10 cursor-pointer"><input type="checkbox" class="w-5 h-5" data-check="homework" /><span class="font-extrabold">ุญู ุงููุงุฌุจุงุช</span></label>
                <label class="flex items-center gap-3 p-3 rounded-2xl border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/10 cursor-pointer"><input type="checkbox" class="w-5 h-5" data-check="noNeglect" /><span class="font-extrabold">ุนุฏู ุงูุฅููุงู</span></label>
                <label class="flex items-center gap-3 p-3 rounded-2xl border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/10 cursor-pointer"><input type="checkbox" class="w-5 h-5" data-check="tidy" /><span class="font-extrabold">ุชูุธูู ุงูููุช/ุงูุญููุจุฉ</span></label>
                <label class="flex items-center gap-3 p-3 rounded-2xl border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/10 cursor-pointer"><input type="checkbox" class="w-5 h-5" data-check="helpHome" /><span class="font-extrabold">ูุณุงุนุฏุฉ ุงูุฃูู</span></label>
              </div>

              <div class="mt-5 rounded-2xl p-4 border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/5">
                <div class="font-black mb-2">๐ ุชูุฏู ุงูููู</div>
                <div class="h-3 bg-black/5 dark:bg-white/10 rounded-full overflow-hidden border border-black/10 dark:border-white/15">
                  <div id="todayBar" class="h-full bg-gradient-to-l from-fd-wood to-fd-sand" style="width:0%"></div>
                </div>
                <div id="todayHint" class="mt-2 text-sm font-extrabold opacity-80">โ</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- STUDENTS -->
      <section id="students-section" class="section-content hidden">
        <div class="bg-white/85 dark:bg-white/5 rounded-[28px] shadow-soft border border-black/5 dark:border-white/10 p-6 md:p-8">
          <div class="flex items-center gap-3 mb-6">
            <div class="w-12 h-12 rounded-2xl bg-fd-sand/70 dark:bg-white/10 border border-black/5 dark:border-white/10 flex items-center justify-center text-2xl shadow-stamp">๐</div>
            <h2 class="text-2xl md:text-3xl font-black">ุฑูุถุงู ูุงูุทูุงุจ</h2>
          </div>

          <div class="grid lg:grid-cols-2 gap-4">
            <div class="rounded-2xl p-5 border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/5">
              <div class="font-black text-lg mb-2">โ ููู ุชุฐุงูุฑ ูู ุฑูุถุงูุ</div>
              <ul class="space-y-2 font-semibold opacity-90">
                <li>โข ูู ูุจูุฑุงู ูุฏุฑ ุงูุฅููุงู.</li>
                <li>โข ุฐุงูุฑ ุจุนุฏ ุงููุฌุฑ ุฃู ุจุนุฏ ุงูุนุตุฑ.</li>
                <li>โข ุฌูุณุงุช ูขู ุฏูููุฉ ุซู ุฑุงุญุฉ ูฅ ุฏูุงุฆู.</li>
                <li>โข ุญู ุงููุงุฌุจ ุฃููุงู ุซู ุงููุฑุงุฌุนุฉ.</li>
                <li>โข ุงุจุชุนุฏ ุนู ุงูุชุณููู ูุงูุฌูุงู ููุช ุงููุฐุงูุฑุฉ.</li>
              </ul>
            </div>

            <div class="rounded-2xl p-5 border border-black/5 dark:border-white/10 bg-gradient-to-l from-fd-sand/50 to-white/70 dark:from-white/10 dark:to-white/5">
              <div class="font-black text-lg mb-2">โญ ุฎุทุฉ ุจุณูุทุฉ ููุฅูุฌุงุฒ</div>
              <div class="space-y-3 font-semibold opacity-90">
                <div class="p-3 rounded-2xl border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/10">๐ฏ ูุฏู ุงูููู: <b>ูุงุฌุจ ูุงุญุฏ + ูุฑุงุฌุนุฉ ุฏุฑุณ</b></div>
                <div class="p-3 rounded-2xl border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/10">๐ ููุงูุฃุฉ: <b>ูขู ุฏูููุฉ ุชุฑููู</b> ุจุนุฏ ุงูุฅูุฌุงุฒ</div>
                <div class="p-3 rounded-2xl border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/10">๐ ูุจู ุงูููู: <b>ุชุฌููุฒ ุดูุทุฉ ุงูุบุฏ</b></div>
              </div>
            </div>
          </div>

          <div class="mt-6 rounded-2xl p-5 border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/5">
            <div class="font-black mb-2">๐ ุงุฑุจุทูุง ุจุงููุชุงุจุนุฉ</div>
            <div class="font-semibold opacity-85">ุงุฏุฎู ูุณู <b>ุงููุชุงุจุนุฉ</b> ููุนูู ููุงู ุงูุทุงูุจ ููููุงู ูุฑูุน ููุงุทู.</div>
          </div>
        </div>
      </section>

    </main>

    <footer class="py-8 px-4 text-center border-t border-black/5 dark:border-white/10">
      <div class="font-black text-lg">ุฑูุถุงู ุงููุจุงุฑู</div>
      <div class="opacity-80 text-sm font-bold">ุชุทุจูู ูุชุงุจุนุฉ ุงูุนุจุงุฏุงุช ูุงูุฅูุฌุงุฒ ุงูุฏุฑุงุณู</div>
      <div class="mt-3 opacity-85 text-sm font-extrabold">ุฅุนุฏุงุฏ: ุฃ/ ูุงุทูุฉ ูุฒุงุฒู โ ููุชูู ูุนููู ููุนููุงุช ุงูุฑูุงุถูุงุช โข ููุชูู ุงูุชุนููู ุงูุชูุงุนูู</div>
    </footer>

  </div>

  <!-- Modal: ุชูุงุตูู ุงูููู -->
  <div id="valueModal" class="modal-hidden fixed inset-0 z-[999]">
    <div class="absolute inset-0 bg-black/50" data-modal-close="1"></div>

    <div class="relative max-w-3xl mx-auto px-4 py-8">
      <div class="rounded-[26px] bg-white/95 dark:bg-black/70 border border-black/10 dark:border-white/15 shadow-soft p-6 md:p-7">
        <div class="flex items-start justify-between gap-3">
          <div>
            <div id="modalTitle" class="text-2xl md:text-3xl font-black">โ</div>
            <div id="modalSubtitle" class="mt-1 text-sm md:text-base font-extrabold opacity-80">โ</div>
          </div>
          <button id="modalCloseBtn" class="px-4 py-2 rounded-2xl font-black border-2 border-fd-bark hover:bg-fd-sand/50 dark:hover:bg-white/10">โ ุฅุบูุงู</button>
        </div>

        <div id="modalBody" class="mt-5 space-y-3 font-semibold leading-relaxed opacity-90"></div>

        <div class="mt-6 flex flex-wrap gap-2 justify-end">
          <button id="modalAddPointBtn" class="px-5 py-3 rounded-2xl font-black bg-gradient-to-l from-fd-deep to-fd-ink text-white hover:opacity-95">โญ ุณุฌูููุง ุงูููู</button>
        </div>
      </div>
    </div>
  </div>


  <script>
    const LS_KEY = "ramadan_app_min_v1";
    // ุงูุชุฑุงุถู: ูก ุฑูุถุงู 1447 (ูุชููุน) โ ูููู ุชุบููุฑู ูู ุฏุงุฎู ุงูุชุทุจูู
    const DEFAULT_RAMADAN_TARGET_ISO = "2026-02-18T00:00:00+03:00";

    const RAMADAN_LOGO_DATA =
      "data:image/svg+xml;charset=UTF-8," +
      encodeURIComponent(`
        <svg xmlns="http://www.w3.org/2000/svg" width="240" height="240" viewBox="0 0 240 240">
          <defs>
            <linearGradient id="g" x1="0" x2="1" y1="0" y2="1">
              <stop offset="0" stop-color="#5a382c"/>
              <stop offset="1" stop-color="#a77a5c"/>
            </linearGradient>
          </defs>
          <rect width="240" height="240" fill="none"/>
          <path d="M140 38c-38 10-62 46-52 85 10 39 45 63 84 53-26 14-59 13-86-6-41-30-49-87-19-128 19-26 49-38 73-35z"
                fill="url(#g)" opacity="0.95"/>
          <g fill="none" stroke="#3b2a22" stroke-width="6" stroke-linecap="round" stroke-linejoin="round">
            <path d="M120 70v18"/><path d="M96 96h48"/>
            <path d="M104 96l-10 18 10 18h32l10-18-10-18"/>
            <path d="M108 132v34"/><path d="M132 132v34"/>
            <path d="M102 166h36"/><path d="M112 184h16"/>
          </g>
          <text x="120" y="214" text-anchor="middle" font-family="Tajawal, Arial" font-size="22" font-weight="900" fill="#3b2a22">ุฑูุถุงู</text>
        </svg>
      `);

    const AR = "ููกูขูฃูคูฅูฆูงูจูฉ";
    const toArabicDigits = (input) => String(input).replace(/\d/g, d => AR[d]);
    const pad2 = (n) => String(n).padStart(2, "0");
    const clamp = (n,a,b)=>Math.max(a,Math.min(b,n));

    function formatDateArabic(date){
      const d = toArabicDigits(date.getDate());
      const m = toArabicDigits(date.getMonth()+1);
      const y = toArabicDigits(date.getFullYear());
      return `${d}/${m}/${y}`;
    }
    function localISODate(){
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,"0");
      const day = String(d.getDate()).padStart(2,"0");
      return `${y}-${m}-${day}`;
    }

    const state = { ramadanTargetISO: DEFAULT_RAMADAN_TARGET_ISO, schedule:null, days:{}, media:{ radioUrl:"https://qurango.net/radio/tarateel", murattalUrl:"https://download.quranicaudio.com/quran/mishaari_raashid_al_3afaasee/001.mp3" }, bonus:0 };

    const DEFAULT_SCHEDULE = [
      { slot:"ูุจู ุงููุฌุฑ", worship:"ุณุญูุฑ + ููุฉ ุงูุตูุงู", student:"ููู ูุจูุฑ ุฃูุณ + ุชุฌููุฒ ุงูุญููุจุฉ" },
      { slot:"ุจุนุฏ ุงููุฌุฑ", worship:"ุฃุฐูุงุฑ ุงูุตุจุงุญ + ูุฑุฏ ูุฑุขู", student:"ูุฑุงุฌุนุฉ ูุตูุฑุฉ (ูขู ุฏูููุฉ)" },
      { slot:"ุงููุฏุฑุณุฉ/ุงูุฏูุงู", worship:"ุญุณู ุงูุฎูู + ุฐูุฑ ุจุณูุท", student:"ุชุฑููุฒ + ูุดุงุฑูุฉ + ุญู ูุงุฌุจุงุช" },
      { slot:"ุงูุธูุฑ", worship:"ุตูุงุฉ ุงูุธูุฑ ูู ููุชูุง", student:"ุญู ูุงุฌุจ ุณุฑูุน / ุชุฑุชูุจ ุงูุฏุฑูุณ" },
      { slot:"ุงูุนุตุฑ", worship:"ุตูุงุฉ ุงูุนุตุฑ + ุฏุนุงุก", student:"ูุฐุงูุฑุฉ + ูุฑุงุฌุนุฉ" },
      { slot:"ูุจู ุงููุบุฑุจ", worship:"ุงุณุชุบูุงุฑ + ุฏุนุงุก", student:"ูุณุงุนุฏุฉ ุงูุฃูู + ุชุฑุชูุจ ุงูููุงู" },
      { slot:"ุงููุบุฑุจ", worship:"ุฅูุทุงุฑ + ุตูุงุฉ ุงููุบุฑุจ", student:"ุฑุงุญุฉ ูุตูุฑุฉ" },
      { slot:"ุจุนุฏ ุงูุนุดุงุก", worship:"ุชุฑุงููุญ + ุฃุฐูุงุฑ ุงููุณุงุก", student:"ูุฑุงุฌุนุฉ ุฎูููุฉ ุซู ููู ูุจูุฑ" }
    ];

    const TASKS = [
      { id:"fajr", w:1 }, { id:"dhuhr", w:1 }, { id:"asr", w:1 }, { id:"maghrib", w:1 }, { id:"isha", w:1 },
      { id:"taraweeh", w:1 }, { id:"adhkarAm", w:1 }, { id:"adhkarPm", w:1 }, { id:"parents", w:1 }, { id:"charity", w:1 },
      { id:"study", w:1 }, { id:"homework", w:1 }, { id:"noNeglect", w:1 }, { id:"tidy", w:1 }, { id:"helpHome", w:1 },
      { id:"quran", w:2 }, { id:"istighfar", w:1 }
    ];

    function loadState(){
      try{
        const s = JSON.parse(localStorage.getItem(LS_KEY) || "{}");        if(typeof s.ramadanTargetISO === "string") state.ramadanTargetISO = s.ramadanTargetISO;
        if(Array.isArray(s.schedule)) state.schedule = s.schedule;
        if(s.days && typeof s.days === "object") state.days = s.days;
        if(s.media && typeof s.media === "object") state.media = { ...state.media, ...s.media };
        if(typeof s.bonus === "number") state.bonus = s.bonus;
      }catch(e){}
      if(!Array.isArray(state.schedule)) state.schedule = DEFAULT_SCHEDULE.map(x=>({...x}));
    }
    function saveState(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }

    function addPoints(n){
      state.bonus = (state.bonus || 0) + (Number(n)||0);
      saveState();
      updateStats();
    }
    // Reset
    document.getElementById("resetBtn").addEventListener("click", ()=>{
      if(confirm("ูู ุชุฑูุฏ ุฅุนุงุฏุฉ ุถุจุท ูู ุดูุก (ุงูุฌุฏูู + ุงููุชุงุจุนุฉ + ุงูุฅุนุฏุงุฏุงุช)ุ")){
        localStorage.removeItem(LS_KEY);
        location.reload();
      }
    });

    // Nav
    function showSection(sectionName){
      document.querySelectorAll(".section-content").forEach(s=>s.classList.add("hidden"));
      const sec = document.getElementById(`${sectionName}-section`);
      if(sec) sec.classList.remove("hidden");
      document.querySelectorAll(".nav-btn").forEach(b=>b.classList.remove("active"));
      const btn = document.querySelector(`[data-section="${sectionName}"]`);
      if(btn) btn.classList.add("active");
      window.scrollTo({ top: 0, behavior: "smooth" });
    }
    window.showSection = showSection;

    // Countdown
    function parseTarget(){ return new Date(state.ramadanTargetISO); }

    function setTargetFromInputs(){
      const dateEl = document.getElementById("ramadanDateInput");
      const timeEl = document.getElementById("ramadanTimeInput");
      const d = dateEl.value;
      const t = timeEl.value || "00:00";
      if(!d) return;
      const isoLocal = `${d}T${t}:00`;
      const target = new Date(isoLocal);
      if(isNaN(target.getTime())) return;
      state.ramadanTargetISO = isoLocal;
      saveState();
      updateCountdown();
      flashMsg("ุชู ุญูุธ ุงูููุนุฏ โ");
    }

    document.getElementById("saveRamadanTargetBtn").addEventListener("click", setTargetFromInputs);

    function updateCountdown(){
      const now = new Date();
      document.getElementById("todayText").textContent = formatDateArabic(now);

      const target = parseTarget();
      const diffMs = target - now;

      if(diffMs <= 0){
        document.getElementById("countdownText").textContent = "ุฑูุถุงู ุจุฏุฃ ๐";
        setCountdownBoxes(0,0,0,0);
        document.getElementById("cdNote").textContent = "ุฅุฐุง ุฑุบุจุช ุนุฏูู ุงูููุนุฏ ูู ุงูุฅุนุฏุงุฏุงุช.";
        return;
      }

      const totalSec = Math.floor(diffMs/1000);
      const days = Math.floor(totalSec / 86400);
      const hours = Math.floor((totalSec % 86400) / 3600);
      const minutes = Math.floor((totalSec % 3600) / 60);
      const seconds = totalSec % 60;

      document.getElementById("countdownText").textContent =
        `${toArabicDigits(days)} ููู ${toArabicDigits(pad2(hours))}:${toArabicDigits(pad2(minutes))}:${toArabicDigits(pad2(seconds))}`;

      setCountdownBoxes(days,hours,minutes,seconds);
      document.getElementById("cdNote").textContent = `ุงููุชุจูู ุญุชู ุฑูุถุงู: ${toArabicDigits(days)} ููู`;
    }

    function setCountdownBoxes(days,hours,minutes,seconds){
      document.getElementById("cdDays").textContent = toArabicDigits(days);
      document.getElementById("cdHours").textContent = toArabicDigits(pad2(hours));
      document.getElementById("cdMinutes").textContent = toArabicDigits(pad2(minutes));
      document.getElementById("cdSeconds").textContent = toArabicDigits(pad2(seconds));
    }

    // Schedule
    function renderSchedule(){
      const tbody = document.getElementById("scheduleBody");
      tbody.innerHTML = "";
      state.schedule.forEach((row, idx)=>{
        const tr = document.createElement("tr");
        tr.className = (idx%2===0) ? "bg-white/50 dark:bg-white/5" : "bg-white/70 dark:bg-white/10";
        tr.innerHTML = `
          <td class="p-3 font-black whitespace-nowrap">${esc(row.slot)}</td>
          <td class="p-3"><textarea data-sch="worship" data-i="${idx}" class="w-full min-h-[44px] rounded-2xl px-3 py-2 border border-black/10 dark:border-white/15 bg-white/80 dark:bg-white/10 outline-none">${esc(row.worship)}</textarea></td>
          <td class="p-3"><textarea data-sch="student" data-i="${idx}" class="w-full min-h-[44px] rounded-2xl px-3 py-2 border border-black/10 dark:border-white/15 bg-white/80 dark:bg-white/10 outline-none">${esc(row.student)}</textarea></td>
        `;
        tbody.appendChild(tr);
      });

      tbody.querySelectorAll("textarea[data-sch]").forEach(t=>{
        t.addEventListener("input", ()=>{
          const idx = Number(t.dataset.i);
          const key = t.dataset.sch;
          state.schedule[idx][key] = t.value;
        });
      });
    }

    document.getElementById("saveScheduleBtn").addEventListener("click", ()=>{
      saveState();
      document.getElementById("scheduleSavedMsg").textContent = "ุชู ุญูุธ ุงูุฌุฏูู โ";
      setTimeout(()=>document.getElementById("scheduleSavedMsg").textContent="", 1800);
    });

    document.getElementById("resetScheduleBtn").addEventListener("click", ()=>{
      if(confirm("ูู ุชุฑูุฏ ุงุณุชุฑุฌุงุน ุงูุฌุฏูู ุงูุงูุชุฑุงุถูุ")){
        state.schedule = DEFAULT_SCHEDULE.map(x=>({...x}));
        saveState();
        renderSchedule();
        document.getElementById("scheduleSavedMsg").textContent = "ุชู ุงุณุชุฑุฌุงุน ุงูุฌุฏูู โ";
        setTimeout(()=>document.getElementById("scheduleSavedMsg").textContent="", 1800);
      }
    });

    // Tracker
    function ensureToday(){
      const key = localISODate();
      if(!state.days[key]){
        state.days[key] = { checks:{}, quranPages:0, quranGoal:4, istighfar:0 };
      }
      return { key, data: state.days[key] };
    }

    function bindTracker(){
      const { key, data } = ensureToday();
      document.getElementById("todayKeyText").textContent = key;

      document.querySelectorAll("input[type=checkbox][data-check]").forEach(cb=>{
        const id = cb.dataset.check;
        cb.checked = !!data.checks[id];
        cb.addEventListener("change", ()=>{
          data.checks[id] = cb.checked;
          saveState();
          updateStats();
        });
      });

      const qPages = document.getElementById("quranPages");
      const qGoal = document.getElementById("quranGoal");
      qPages.value = data.quranPages ?? 0;
      qGoal.value = data.quranGoal ?? 4;

      qPages.addEventListener("input", ()=>{
        data.quranPages = Math.max(0, Number(qPages.value||0));
        saveState(); updateStats();
      });
      qGoal.addEventListener("input", ()=>{
        data.quranGoal = Math.max(1, Number(qGoal.value||1));
        saveState(); updateStats();
      });

      const istTxt = document.getElementById("istighfarCount");
      istTxt.textContent = toArabicDigits(data.istighfar ?? 0);

      document.querySelectorAll("[data-ist]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const add = Number(btn.dataset.ist||0);
          data.istighfar = (data.istighfar ?? 0) + add;
          istTxt.textContent = toArabicDigits(data.istighfar);
          saveState(); updateStats();
        });
      });
      document.getElementById("istReset").addEventListener("click", ()=>{
        data.istighfar = 0;
        istTxt.textContent = "ู";
        saveState(); updateStats();
      });

      document.getElementById("resetTodayBtn").addEventListener("click", ()=>{
        if(confirm("ูู ุชุฑูุฏ ุชุตููุฑ ููุงู ุงููููุ")){
          data.checks = {};
          data.quranPages = 0;
          data.istighfar = 0;
          bindTracker();
          saveState(); updateStats();
        }
      });
    }

    function computeTodayProgress(){
      const { data } = ensureToday();
      let earned = 0, max = 0;

      for(const t of TASKS){
        max += t.w;
        if(t.id === "quran"){
          const goal = Math.max(1, Number(data.quranGoal||1));
          const pages = Math.max(0, Number(data.quranPages||0));
          earned += clamp(pages/goal, 0, 1) * t.w;
        } else if(t.id === "istighfar"){
          const goal = 100;
          const count = Math.max(0, Number(data.istighfar||0));
          earned += clamp(count/goal, 0, 1) * t.w;
        } else {
          earned += (data.checks[t.id] ? t.w : 0);
        }
      }

      const pct = max ? Math.round((earned/max)*100) : 0;
      return { pct, earned, max };
    }

    function computeTotalPoints(){
      let total = 0;
      const keys = Object.keys(state.days || {});
      for(const k of keys){
        const d = state.days[k];
        let earned = 0, max = 0;
        for(const t of TASKS){
          max += t.w;
          if(t.id === "quran"){
            const goal = Math.max(1, Number(d.quranGoal||1));
            const pages = Math.max(0, Number(d.quranPages||0));
            earned += clamp(pages/goal,0,1)*t.w;
          } else if(t.id === "istighfar"){
            earned += clamp((Number(d.istighfar||0))/100,0,1)*t.w;
          } else {
            earned += (d.checks?.[t.id] ? t.w : 0);
          }
        }
        total += Math.round((earned/max)*10); // ููุงุท ุงูููู 0..10
      }
      return total + (state.bonus || 0);
    }

    function badgeFromPoints(p){
      if(p >= 120) return "๐ ูุฏูุฉ ุฑูุถุงููุฉ";
      if(p >= 80) return "๐ ูุชููุฒ";
      if(p >= 40) return "๐ ูุชูุงุนู";
      if(p >= 15) return "โจ ุจุฏุงูุฉ ูููุฉ";
      return "๐ ุงุจุฏุฃ ุงูุขู";
    }

    function updateStats(){
      const { pct } = computeTodayProgress();
      const totalPoints = computeTotalPoints();

      document.getElementById("todayProgressText").textContent = toArabicDigits(pct) + "ูช";
      document.getElementById("todayBar").style.width = pct + "%";
      document.getElementById("todayHint").textContent =
        (pct>=80) ? "๐ ููุชุงุฒ! ุงุณุชูุฑ." :
        (pct>=50) ? "๐ ุฌูุฏ! ุฃููู ูุชุตู ูจููช." : "๐ ุงุจุฏุฃ ุจุฎุทูุฉ ุจุณูุทุฉ.";

      document.getElementById("pointsText").textContent = toArabicDigits(totalPoints);
      document.getElementById("badgeText").textContent = badgeFromPoints(totalPoints);

      const overall = clamp(Math.round((pct*0.7) + (clamp(totalPoints/120,0,1)*30)), 0, 100);
      document.getElementById("overallBar").style.width = overall + "%";
    }

    // helpers
    function esc(s){
      return String(s).replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
    }

    let flashTimer = null;
    function flashMsg(msg){
      let el = document.getElementById("flashMsg");
      if(!el){
        el = document.createElement("div");
        el.id = "flashMsg";
        el.style.position = "fixed";
        el.style.top = "16px";
        el.style.left = "16px";
        el.style.zIndex = "9999";
        el.style.padding = "12px 14px";
        el.style.borderRadius = "16px";
        el.style.fontWeight = "900";
        el.style.background = "rgba(255,255,255,.92)";
        el.style.border = "1px solid rgba(0,0,0,.08)";
        el.style.boxShadow = "0 18px 45px rgba(2,6,23,.12)";
        document.body.appendChild(el);
      }
      el.textContent = msg;
      el.style.opacity = "1";
      clearTimeout(flashTimer);
      flashTimer = setTimeout(()=>{ el.style.opacity = "0"; }, 1500);
    }


    /**********************
     * ุงูููู (ุจุทุงูุงุช ุชูููุจ + ูุงูุฐุฉ ุชูุงุตูู)
     **********************/
    const RAMADAN_VALUES = [
      {
        id:"discipline",
        icon:"๐ง",
        title:"ุงูุงูุถุจุงุท",
        short:"ุงูุชุฒุงู ุงูููุช (ุตูุงุฉ/ูุฑุฏ/ูุฐุงูุฑุฉ).",
        bullets:["ุญุฏุฏ ูฃ ุฃูุฏุงู ููููุฉ ูุงุถุญุฉ.","ุงุณุชุฎุฏู ูุคููุช ูขู ุฏูููุฉ ูููุฐุงูุฑุฉ.","ูููู ุงููุดุชุชุงุช (ุงูุฌูุงู/ุงูุชุฃุฌูู)."],
        details: [
          "ุงูุงูุถุจุงุท ูุนูู: ุฃูุชุฒู ุจููุชู ูุฃุฑุชูุจ ุฃููููุงุชู ูุฃููู ูุง ุฃุจุฏุฃู.",
          "ููุนุจุงุฏุฉ: ุตูุงุฉ ูู ููุชูุง + ูุฑุฏ ูุฑุขู ุซุงุจุช ููู ูููู.",
          "ููุทูุงุจ: ุฌูุณุงุช ูุตูุฑุฉ (ูขู ุฏูููุฉ) + ุญู ูุงุฌุจุงุช ูุจู ุงูุชุฑููู.",
          "ุชุญุฏู ุนููู: ุงุฎุชุฑ ููุชูุง ุซุงุจุชูุง ูููููุง ููุฑุฏ ุงููุฑุขู ูุงูุชุฒู ุจู ุฃุณุจูุนูุง."
        ]
      },
      {
        id:"patience",
        icon:"โณ",
        title:"ุงูุตุจุฑ",
        short:"ุงูุตูุงู ูุนููู ุถุจุท ุงูููุณ.",
        bullets:["ูุฏูุก ุนูุฏ ุงูุบุถุจ.","ุชุญููู ุงูุฌูุน ูุงูุนุทุด.","ุงูุตุจุฑ ุนูู ุงูุนุจุงุฏุฉ."],
        details: [
          "ุงูุตุจุฑ ูู ุฑูุถุงู: ุฃุชุญูู ูู ุฑุฏูุงุช ูุนูู ูุฃุญุณู ุงูุชุนุงูู ูุน ุงูุขุฎุฑูู.",
          "ูุตูุญุฉ ุณุฑูุนุฉ: ุฅุฐุง ุบุถุจุชโุชูููุณ ุจุนููุ ูุบููุฑ ุงูููุงูุ ูุงุฐูุฑ ุงููู.",
          "ููุทูุงุจ: ูุง ุชุคุฌู ุงููุงุฌุจุงุชุ ุฃูุฌุฒ ุฎุทูุฉ ุตุบูุฑุฉ ูู ููู.",
          "ุชุญุฏู ุนููู: ุงุณุชุจุฏู ูููุฉ ูุงุณูุฉ ุจูููุฉ ุทูุจุฉ ูฃ ูุฑุงุช ูููููุง."
        ]
      },
      {
        id:"ihsan",
        icon:"๐ค",
        title:"ุงูุฅุญุณุงู",
        short:"ูุณุงุนุฏุฉ ุงูุขุฎุฑูู ูุงูุตุฏูุฉ.",
        bullets:["ุตุฏูุฉ ููู ููููุฉ.","ูุณุงุนุฏุฉ ุงูุฃูู/ุงูุฒููุงุก.","ูููุฉ ุทูุจุฉ."],
        details: [
          "ุงูุฅุญุณุงู: ุฃู ุฃุญุณู ูููุงุณ ููููุง ููุนููุง.",
          "ุฃูุซูุฉ: ุงุจุชุณุงูุฉุ ูุณุงุนุฏุฉ ุฃุฎ/ุฃุฎุชุ ุชุฑุชูุจ ุณูุฑุฉุ ูุดุงุฑูุฉ ุทุนุงู.",
          "ููุทูุงุจ: ุงูุชุนุงูู ูุน ุงูุฒููุงุกุ ูุงุญุชุฑุงู ุงููุนููุ ููุณุงุนุฏุฉ ูู ูุญุชุงุฌ ุดุฑุญูุง.",
          "ุชุญุฏู ุนููู: ุนูู ุฅุญุณุงู ูุงุญุฏ ูููููุง ูุณุฌููู ูู ุงููุชุงุจุนุฉ."
        ]
      },
      {
        id:"parents",
        icon:"๐",
        title:"ุจุฑู ุงููุงูุฏูู",
        short:"ุฎุฏูุฉ ุงููุงูุฏูู ูุงููููุฉ ุงูุทูุจุฉ.",
        bullets:["ุทุงุนุฉ ุจุงููุนุฑูู.","ุฏุนุงุก ูููุง.","ุฎุฏูุฉ ุจุณูุทุฉ ูููููุง."],
        details: [
          "ุจุฑู ุงููุงูุฏูู: ุฃูุญุณู ุงูููุงู ูุฃุจุงุฏุฑ ุจุงูุฎุฏูุฉ ูุงูุฏุนุงุก.",
          "ุฃูุซูุฉ: ุชุฑุชูุจ ุงูููุงูุ ุฅุญุถุงุฑ ูุงุก/ุฏูุงุกุ ุณุคุงู ุนู ุงูุญุงู.",
          "ููุทูุงุจ: ูุง ุชุคุฎุฑ ุทูุจ ุงููุงูุฏูู ุจุญุฌุฉ ุงูุฏุฑุงุณุฉุ ูุธูู ููุชู.",
          "ุชุญุฏู ุนููู: ูููุฉ ุทูุจุฉ + ุฎุฏูุฉ ูุงุญุฏุฉ ูููููุง."
        ]
      },
      {
        id:"quranlove",
        icon:"๐",
        title:"ูุญุจุฉ ุงููุฑุขู",
        short:"ูุฑุฏ ูููู ููู ุตูุญุงุช ููููุฉ.",
        bullets:["ุญุฏุฏ ูุฏู ุตูุญุงุช.","ุงุณุชูุน ูุชูุงูุฉ ูุฑุชูุฉ.","ุชุฏุจุฑ ุขูุฉ ูููููุง."],
        details: [
          "ุฑูุถุงู ุดูุฑ ุงููุฑุขู: ุงุฌุนู ูู ูุฑุฏูุง ุซุงุจุชูุง ููู ูขโูค ุตูุญุงุช.",
          "ููููู ุงูุงุณุชูุงุน ููุชูุงูุฉ ุฃุซูุงุก ุงููุดู/ุงูุชุฑุชูุจ (ุจุฏูู ุชุดุชูุช).",
          "ููุทูุงุจ: ุงูุฑุฃ ุจุนุฏ ุงููุฌุฑ ุฃู ุจุนุฏ ุงูุนุตุฑ ุนูุฏูุง ูููู ุงูุฐูู ุตุงูููุง.",
          "ุชุญุฏู ุนููู: ุงุณุชูุน ูุณูุฑุฉ ูุตูุฑุฉ ูุงุญูุธ ุขูุฉ ูุงุญุฏุฉ ูุฐุง ุงูุฃุณุจูุน."
        ]
      },
      {
        id:"dhikr",
        icon:"๐ธ",
        title:"ุงูุฐูุฑ ูุงูุงุณุชุบูุงุฑ",
        short:"ุฃุฐูุงุฑ + ุงุณุชุบูุงุฑ ูุณุชูุฑ.",
        bullets:["ุฃุฐูุงุฑ ุงูุตุจุงุญ/ุงููุณุงุก.","ุงุณุชุบูุงุฑ ูููู.","ุฏุนุงุก ูุจู ุงูุฅูุทุงุฑ."],
        details: [
          "ุงูุฐูุฑ ูุทูุฆู ุงูููุจ ููุฒูุฏ ุงูุซุจุงุช.",
          "ุงุจุฏุฃ ุจุงููููู: ูฃู ุงุณุชุบูุงุฑ ุซู ุฒุฏ ุชุฏุฑูุฌููุง.",
          "ููุทูุงุจ: ุงูุฐูุฑ ูุนูู ุนูู ุงูุชุฑููุฒ ูุฑุงุญุฉ ุงูุจุงู.",
          "ุชุญุฏู ุนููู: ุงุฌุนู ูุฏูู ูกูู ุงุณุชุบูุงุฑ ูููููุง (ููุฌูุฏ ุนุฏูุงุฏ ุฏุงุฎู ุงูุชุทุจูู)."
        ]
      }
    ];

    function renderValuesCards(){
      const grid = document.getElementById("valuesGrid");
      if(!grid) return;

      grid.innerHTML = RAMADAN_VALUES.map(v => `
        <div class="flip h-[210px] cursor-pointer" data-val="${v.id}" role="button" tabindex="0" aria-label="ุจุทุงูุฉ ูููุฉ: ${esc(v.title)}">
          <div class="flip-inner w-full h-full">
            <div class="flip-face p-5 bg-white/70 dark:bg-white/5 border border-black/5 dark:border-white/10 shadow-soft">
              <div class="text-4xl">${v.icon}</div>
              <div class="mt-3 text-lg font-black">${esc(v.title)}</div>
              <div class="mt-1 font-semibold opacity-85">${esc(v.short)}</div>
              <div class="mt-3 text-xs font-extrabold opacity-70">ุงุถุบุท ููุชูููุจ</div>
            </div>

            <div class="flip-face flip-back p-5 bg-gradient-to-br from-fd-sand/60 to-white/70 dark:from-white/10 dark:to-white/5 border border-black/5 dark:border-white/10 shadow-soft">
              <div class="text-lg font-black">${esc(v.title)}</div>
              <ul class="mt-3 space-y-2 font-semibold opacity-90">
                ${v.bullets.map(b => `<li>โข ${esc(b)}</li>`).join("")}
              </ul>
              <div class="mt-4 flex gap-2 flex-wrap justify-end">
                <button class="detailsBtn px-4 py-2 rounded-2xl font-black bg-gradient-to-l from-fd-deep to-fd-ink text-white hover:opacity-95" data-detail="${v.id}">๐ ุชูุงุตูู</button>
              </div>
            </div>
          </div>
        </div>
      `).join("");

      // ุชูููุจ ุจุงูุถุบุท
      grid.querySelectorAll(".flip").forEach(card=>{
        const toggle = ()=>{
          card.classList.toggle("flipped");
          addPoints(1);
        };
        card.addEventListener("click", (e)=>{
          // ูู ุถุบุท ุนูู ุฒุฑ ุงูุชูุงุตูู ูุง ุชููุจ
          if(e.target && e.target.closest(".detailsBtn")) return;
          toggle();
        });
        card.addEventListener("keydown", (e)=>{
          if(e.key === "Enter" || e.key === " "){
            e.preventDefault();
            toggle();
          }
        });
      });

      // ุฒุฑ ุงูุชูุงุตูู
      grid.querySelectorAll(".detailsBtn").forEach(btn=>{
        btn.addEventListener("click", (e)=>{
          e.stopPropagation();
          const id = btn.dataset.detail;
          openValueModal(id);
        });
      });
    }

    // Modal
    let currentModalValueId = null;
    const modalEl = document.getElementById("valueModal");
    const modalTitle = document.getElementById("modalTitle");
    const modalSubtitle = document.getElementById("modalSubtitle");
    const modalBody = document.getElementById("modalBody");
    const modalCloseBtn = document.getElementById("modalCloseBtn");
    const modalAddPointBtn = document.getElementById("modalAddPointBtn");

    function openValueModal(id){
      const v = RAMADAN_VALUES.find(x=>x.id===id);
      if(!v || !modalEl) return;

      currentModalValueId = id;
      modalTitle.textContent = v.title;
      modalSubtitle.textContent = "ุชูุงุตูู ุนูููุฉ + ุฃูุซูุฉ ุจุณูุทุฉ ููุชุทุจูู";
      modalBody.innerHTML = v.details.map(p => `<div>โข ${esc(p)}</div>`).join("");

      modalEl.classList.remove("modal-hidden");
      addPoints(1);
    }
    function closeValueModal(){
      if(!modalEl) return;
      modalEl.classList.add("modal-hidden");
      currentModalValueId = null;
    }

    if(modalEl){
      modalEl.querySelectorAll("[data-modal-close]").forEach(el=>{
        el.addEventListener("click", closeValueModal);
      });
    }
    if(modalCloseBtn) modalCloseBtn.addEventListener("click", closeValueModal);

    if(modalAddPointBtn){
      modalAddPointBtn.addEventListener("click", ()=>{
        addPoints(2);
        flashMsg("ุชู ุชุณุฌูู ุงููููุฉ โญ");
        closeValueModal();
      });
    }

    /**********************
     * ุงูุฃุฐูุงุฑ (ูุต + ูุณุฎ + ุงุณุชูุงุน)
     **********************/
    const ADHKAR_AM = [
      { title:"ุฃุตุจุญูุง ูุฃุตุจุญ ุงูููู ููู", text:"ุฃุตุจุญูุง ูุฃุตุจุญ ุงูููู ูููุ ูุงูุญูุฏ ูููุ ูุง ุฅูู ุฅูุง ุงููู ูุญุฏู ูุง ุดุฑูู ููโฆ ูุฅููู ุงููุดูุฑ.", repeat:"" },
      { title:"ุงูููู ุจู ุฃุตุจุญูุง", text:"ุงูููู ุจู ุฃุตุจุญูุง ูุจู ุฃูุณููุง ูุจู ูุญูุง ูุจู ูููุช ูุฅููู ุงููุดูุฑ.", repeat:"" },
      { title:"ุฑุถูุช ุจุงููู ุฑุจุงู", text:"ุฑุถูุช ุจุงููู ุฑุจุงูุ ูุจุงูุฅุณูุงู ุฏููุงูุ ูุจูุญูุฏ ๏ทบ ูุจูุงู.", repeat:"ูฃ ูุฑุงุช" },
      { title:"ุจุณู ุงููู ุงูุฐู ูุง ูุถุฑ", text:"ุจุณู ุงููู ุงูุฐู ูุง ูุถุฑ ูุน ุงุณูู ุดูุก ูู ุงูุฃุฑุถ ููุง ูู ุงูุณูุงุก ููู ุงูุณููุน ุงูุนููู.", repeat:"ูฃ ูุฑุงุช" },
      { title:"ุงูููู ุนุงููู", text:"ุงูููู ุนุงููู ูู ุจุฏููุ ุงูููู ุนุงููู ูู ุณูุนูุ ุงูููู ุนุงููู ูู ุจุตุฑู.", repeat:"ูฃ ูุฑุงุช" },
      { title:"ุณุจุญุงู ุงููู ูุจุญูุฏู", text:"ุณุจุญุงู ุงููู ูุจุญูุฏู.", repeat:"ูกูู ูุฑุฉ (ุงุฎุชูุงุฑู)" }
    ];

    const ADHKAR_PM = [
      { title:"ุฃูุณููุง ูุฃูุณู ุงูููู ููู", text:"ุฃูุณููุง ูุฃูุณู ุงูููู ูููุ ูุงูุญูุฏ ูููโฆ ูุฅููู ุงููุตูุฑ.", repeat:"" },
      { title:"ุงูููู ุจู ุฃูุณููุง", text:"ุงูููู ุจู ุฃูุณููุง ูุจู ุฃุตุจุญูุง ูุจู ูุญูุง ูุจู ูููุช ูุฅููู ุงููุตูุฑ.", repeat:"" },
      { title:"ุฑุถูุช ุจุงููู ุฑุจุงู", text:"ุฑุถูุช ุจุงููู ุฑุจุงูุ ูุจุงูุฅุณูุงู ุฏููุงูุ ูุจูุญูุฏ ๏ทบ ูุจูุงู.", repeat:"ูฃ ูุฑุงุช" },
      { title:"ุจุณู ุงููู ุงูุฐู ูุง ูุถุฑ", text:"ุจุณู ุงููู ุงูุฐู ูุง ูุถุฑ ูุน ุงุณูู ุดูุก ูู ุงูุฃุฑุถ ููุง ูู ุงูุณูุงุก ููู ุงูุณููุน ุงูุนููู.", repeat:"ูฃ ูุฑุงุช" },
      { title:"ุฃุนูุฐ ุจูููุงุช ุงููู ุงูุชุงูุงุช", text:"ุฃุนูุฐ ุจูููุงุช ุงููู ุงูุชุงูุงุช ูู ุดุฑ ูุง ุฎูู.", repeat:"ูฃ ูุฑุงุช" },
      { title:"ุณุจุญุงู ุงููู ูุจุญูุฏู", text:"ุณุจุญุงู ุงููู ูุจุญูุฏู.", repeat:"ูกูู ูุฑุฉ (ุงุฎุชูุงุฑู)" }
    ];

    function copyText(text){
      if(navigator.clipboard && navigator.clipboard.writeText){
        navigator.clipboard.writeText(text).then(()=>flashMsg("ุชู ุงููุณุฎ โ")).catch(()=>flashMsg("ูู ูุชู ุงููุณุฎ"));
      }else{
        // fallback
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        try{ document.execCommand("copy"); flashMsg("ุชู ุงููุณุฎ โ"); }catch(e){ flashMsg("ูู ูุชู ุงููุณุฎ"); }
        ta.remove();
      }
    }
    function renderAdhkarList(containerId, items){
      const box = document.getElementById(containerId);
      if(!box) return;

      box.innerHTML = items.map((it, i)=>`
        <div class="rounded-2xl p-4 border border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/10">
          <div class="flex items-start justify-between gap-2 flex-wrap">
            <div>
              <div class="font-black">${esc(it.title)} ${it.repeat ? `<span class="text-sm font-extrabold opacity-70">(${esc(it.repeat)})</span>` : ""}</div>
              <div class="mt-2 font-semibold opacity-90 leading-relaxed">${esc(it.text)}</div>
            </div>
            <div class="flex gap-2">
              <button class="copyBtn px-3 py-2 rounded-2xl font-black border-2 border-fd-bark hover:bg-fd-sand/50 dark:hover:bg-white/10" data-copy="${i}" data-kind="${containerId}">๐</button>
</div>
          </div>
        </div>
      `).join("");

      box.querySelectorAll(".copyBtn").forEach(b=>{
        b.addEventListener("click", ()=>{
          const idx = Number(b.dataset.copy);
          const kind = b.dataset.kind;
          const arr = (kind==="adhkarAmList") ? ADHKAR_AM : ADHKAR_PM;
          copyText(arr[idx].text);
        });
      });
      });
    }

    function setDailyCheck(id, value){
      const { data } = ensureToday();
      data.checks[id] = value;
      saveState();
      updateStats();
      const cb = document.querySelector(`input[type=checkbox][data-check="${id}"]`);
      if(cb) cb.checked = value;
    }

    function initAdhkar(){
      renderAdhkarList("adhkarAmList", ADHKAR_AM);
      renderAdhkarList("adhkarPmList", ADHKAR_PM);

      const amMark = document.getElementById("amMarkDoneBtn");
      const pmMark = document.getElementById("pmMarkDoneBtn");
      if(amMark) amMark.addEventListener("click", ()=>{ setDailyCheck("adhkarAm", true); flashMsg("ุชู ุชุณุฌูู ุฃุฐูุงุฑ ุงูุตุจุงุญ โ"); addPoints(2); });
      if(pmMark) pmMark.addEventListener("click", ()=>{ setDailyCheck("adhkarPm", true); flashMsg("ุชู ุชุณุฌูู ุฃุฐูุงุฑ ุงููุณุงุก โ"); addPoints(2); });
    }

    /**********************
     * ุฅุฐุงุนุฉ ุงููุฑุขู + ุงููุตุญู ุงููุฑุชู
     **********************/
    function initMediaPlayers(){
      const radioPreset = document.getElementById("radioPreset");
      const radioUrlInput = document.getElementById("radioUrlInput");
      const radioPlayBtn = document.getElementById("radioPlayBtn");
      const radioStopBtn = document.getElementById("radioStopBtn");
      const radioSaveBtn = document.getElementById("radioSaveBtn");
      const radioPlayer = document.getElementById("radioPlayer");
      const radioHint = document.getElementById("radioHint");

      const murPreset = document.getElementById("murattalPreset");
      const murUrlInput = document.getElementById("murattalUrlInput");
      const murPlayBtn = document.getElementById("murattalPlayBtn");
      const murStopBtn = document.getElementById("murattalStopBtn");
      const murSaveBtn = document.getElementById("murattalSaveBtn");
      const murPlayer = document.getElementById("murattalPlayer");
      const murHint = document.getElementById("murattalHint");

      if(radioUrlInput) radioUrlInput.value = state.media?.radioUrl || "";
      if(murUrlInput) murUrlInput.value = state.media?.murattalUrl || "";

      function applyRadio(url){
        if(!radioPlayer) return;
        if(!url){ radioHint.textContent = "ุงุฎุชุฑ ูุญุทุฉ ุฃู ุถุน ุฑุงุจุทูุง."; return; }
        radioPlayer.src = url;
        radioPlayer.play().then(()=>{
          radioHint.textContent = "ูุนูู ุงูุขู โ";
        }).catch(()=>{
          radioHint.textContent = "ูู ูุนูู ุงูุชุดุบูู. ุฌุฑูุจ ุฑุงุจุทูุง ุขุฎุฑ.";
        });
      }
      function stopRadio(){
        if(!radioPlayer) return;
        radioPlayer.pause();
        radioPlayer.removeAttribute("src");
        radioPlayer.load();
        if(radioHint) radioHint.textContent = "ุชู ุงูุฅููุงู.";
      }

      function applyMurattal(url){
        if(!murPlayer) return;
        if(!url){ murHint.textContent = "ุงุฎุชุฑ ุชูุงูุฉ ุฃู ุถุน ุฑุงุจุท MP3."; return; }
        murPlayer.src = url;
        murPlayer.play().then(()=>{
          murHint.textContent = "ูุนูู ุงูุขู โ";
        }).catch(()=>{
          murHint.textContent = "ูู ูุนูู ุงูุชุดุบูู. ุฌุฑูุจ ุฑุงุจุทูุง ุขุฎุฑ.";
        });
      }
      function stopMurattal(){
        if(!murPlayer) return;
        murPlayer.pause();
        murPlayer.removeAttribute("src");
        murPlayer.load();
        if(murHint) murHint.textContent = "ุชู ุงูุฅููุงู.";
      }

      if(radioPreset){
        radioPreset.addEventListener("change", ()=>{
          if(radioPreset.value) radioUrlInput.value = radioPreset.value;
        });
      }
      if(murPreset){
        murPreset.addEventListener("change", ()=>{
          if(murPreset.value) murUrlInput.value = murPreset.value;
        });
      }

      if(radioPlayBtn) radioPlayBtn.addEventListener("click", ()=> applyRadio((radioUrlInput.value||"").trim()));
      if(radioStopBtn) radioStopBtn.addEventListener("click", stopRadio);
      if(radioSaveBtn) radioSaveBtn.addEventListener("click", ()=>{
        state.media = state.media || {};
        state.media.radioUrl = (radioUrlInput.value||"").trim();
        saveState();
        flashMsg("ุชู ุญูุธ ุฑุงุจุท ุงูุฅุฐุงุนุฉ โ");
      });

      if(murPlayBtn) murPlayBtn.addEventListener("click", ()=> applyMurattal((murUrlInput.value||"").trim()));
      if(murStopBtn) murStopBtn.addEventListener("click", stopMurattal);
      if(murSaveBtn) murSaveBtn.addEventListener("click", ()=>{
        state.media = state.media || {};
        state.media.murattalUrl = (murUrlInput.value||"").trim();
        saveState();
        flashMsg("ุชู ุญูุธ ุฑุงุจุท ุงูุชูุงูุฉ โ");
      });

      // ุชููุฆุฉ ุชูููุญุงุช
      if(radioHint) radioHint.textContent = "ุงุฎุชุฑ ูุญุทุฉ ุซู ุงุถุบุท ุชุดุบูู.";
      if(murHint) murHint.textContent = "ุงุฎุชุฑ ุชูุงูุฉ ุซู ุงุถุบุท ุชุดุบูู.";
    }


    function init(){
      // logo
      document.getElementById("ramadanLogo").src = RAMADAN_LOGO_DATA;

      loadState();      // fill target inputs
      const target = parseTarget();
      const dateEl = document.getElementById("ramadanDateInput");
      const timeEl = document.getElementById("ramadanTimeInput");
      if(!isNaN(target.getTime())){
        const y = target.getFullYear();
        const m = String(target.getMonth()+1).padStart(2,"0");
        const d = String(target.getDate()).padStart(2,"0");
        const hh = String(target.getHours()).padStart(2,"0");
        const mm = String(target.getMinutes()).padStart(2,"0");
        dateEl.value = `${y}-${m}-${d}`;
        timeEl.value = `${hh}:${mm}`;
      }else{
        dateEl.value = "";
        timeEl.value = "00:00";
      }

      renderSchedule();
      bindTracker();

      // ููู ุฑูุถุงู (ุจุทุงูุงุช ููููุจุฉ)
      renderValuesCards();

      // ุงูุฃุฐูุงุฑ ูุงููุฑุขู
      initAdhkar();
      initMediaPlayers();

      updateCountdown();
      setInterval(updateCountdown, 1000);

      updateStats();
    }

    init();
  </script>
</body>
</html>
